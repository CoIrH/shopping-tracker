<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ä¸»äººçš„è´­ç‰©è®°å½•å–µ~</title>
  <style>
    body { font-family: sans-serif; background: #fff8f0; color: #333; padding: 20px; }
    h1 { color: #e38cae; }
    label, input, button { margin: 5px; }
    .item { border: 1px solid #ddd; border-radius: 8px; padding: 10px; margin: 10px 0; background: #fff; }
    #input-area { margin-bottom: 20px; }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>ä¸»äººçš„è´­ç‰©è®°å½•å–µ~</h1>

  <div id="input-area" style="display: none;">
    <label>ç‰©å“åç§°ï¼š<input type="text" id="name"></label><br>
    <label>è´­ä¹°æ—¥æœŸï¼š<input type="date" id="date"></label><br>
    <label>èŠ±è´¹é‡‘é¢ï¼ˆå…ƒï¼‰ï¼š<input type="number" id="price"></label><br>
    <button onclick="addItem()">æ·»åŠ è®°å½•å–µï¼</button>
  </div>

  <div id="list"></div>

  <script>
    // Firebase é…ç½®
    const firebaseConfig = {
      apiKey: "AIzaSyCFb-Oqzcde-X1q7YXgvgdEhuq21ppbdvs",
      authDomain: "shoppingtracker-d9826.firebaseapp.com",
      projectId: "shoppingtracker-d9826",
      storageBucket: "shoppingtracker-d9826.firebasestorage.app",
      messagingSenderId: "307253068931",
      appId: "1:307253068931:web:0cd4a55f619f94f89487b6",
      measurementId: "G-J5CSL5T34G"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function daysSince(dateStr) {
      const today = new Date();
      const buyDate = new Date(dateStr);
      const diffTime = today - buyDate;
      return Math.floor(diffTime / (1000 * 60 * 60 * 24));
    }

    async function render() {
      const list = document.getElementById('list');
      const inputArea = document.getElementById('input-area');
      list.innerHTML = '';
      const snapshot = await db.collection("items").get();
      if (snapshot.empty) {
        inputArea.style.display = 'block';
      } else {
        inputArea.style.display = 'none';
        snapshot.forEach((doc) => {
          const item = doc.data();
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `
            <strong>${item.name}</strong><br>
            ğŸ›’ è´­ä¹°æ—¥æœŸï¼š${item.date}<br>
            ğŸ’¸ èŠ±è´¹é‡‘é¢ï¼šÂ¥${item.price}<br>
            ğŸ“… æ‹¥æœ‰ï¼š${daysSince(item.date)} å¤©å–µ~<br>
            <button onclick="removeItem('${doc.id}')">åˆ é™¤å–µ~</button>
          `;
          list.appendChild(div);
        });
      }
    }

    async function addItem() {
      const name = document.getElementById('name').value.trim();
      const date = document.getElementById('date').value;
      const price = parseFloat(document.getElementById('price').value);

      const today = new Date();
      const buyDate = new Date(date);
      today.setHours(0,0,0,0);
      buyDate.setHours(0,0,0,0);

      if (!name || !date || isNaN(price)) {
        alert("è¯·è¾“å…¥å®Œæ•´ä¿¡æ¯å–µ~");
        return;
      }

      if (buyDate > today) {
        alert("è´­ä¹°æ—¥æœŸä¸èƒ½æ™šäºä»Šå¤©å–µï¼");
        return;
      }

      await db.collection("items").add({ name, date, price });
      render();
    }

    async function removeItem(id) {
      await db.collection("items").doc(id).delete();
      render();
    }

    render();
  </script>
</body>
</html>
